# 冒泡排序如何实现，时间复杂度是多少， 还可以如何改进？

## 基础版

```js
function bubbleSort(arr) {
  // console.time('sort1')
  const len = arr.length
  for (let i = 0; i < len; i++) {
    console.log(`第${i + 1}趟`)
    for (let j = 0; j < len - 1 - i; j++) {
      if (arr[j] > arr[j + 1]) {
        ;[arr[j], arr[j + 1]] = [arr[j + 1], arr[j]]
      }
      console.log(`    第${j + 1}次`, arr)
    }
  }

  // console.timeEnd('sort1')
  return arr
}
```

测试：

```js
const arr = [6, 9, 8, 3, 2, 11, 15, 16, 18, 19]
bubbleSort(arr)
```

```text
第1趟
    第1次 [6, 9, 8, 3, 2, 11, 15, 16, 18, 19]
    第2次 [6, 8, 9, 3, 2, 11, 15, 16, 18, 19]
    第3次 [6, 8, 3, 9, 2, 11, 15, 16, 18, 19]
    第4次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第5次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第6次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第7次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第8次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第9次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
第2趟
    第1次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第2次 [6, 3, 8, 2, 9, 11, 15, 16, 18, 19]
    第3次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
    第4次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
    第5次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
    第6次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
    第7次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
    第8次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
第3趟
    第1次 [3, 6, 2, 8, 9, 11, 15, 16, 18, 19]
    第2次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
    第3次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
    第4次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
    第5次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
    第6次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
    第7次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
第4趟
    第1次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第2次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第3次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第4次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第5次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第6次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
第5趟
    第1次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第2次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第3次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第4次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第5次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
第6趟
    第1次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第2次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第3次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第4次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
第7趟
    第1次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第2次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第3次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
第8趟
    第1次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第2次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
第9趟
    第1次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
第10趟
```

时间、空间复杂度分析

1. 时间复杂度：由于内外循环都发生 N 次迭代，所以时间复杂度为 O(n^2)。
2. 空间复杂度：只使用了一个变量，所以未 O(1)
3. 是否稳定：稳定排序

## 优化 1

增加一个标记，每次发生交换，就进行标记，如果某次循环完没有标记，则说明已经完成排序。数组有序，剩下的几趟排序就不需要再去执行了，可以提前结束排序。

```js
function bubbleSort2(arr) {
  // console.time('sort2')
  const len = arr.length
  for (let i = 0; i < len; i++) {
    console.log(`第${i + 1}趟`)
    // 假设每趟都已经是有序的了
    let finish = true
    for (let j = 0; j < len - i - 1; j++) {
      if (arr[j] > arr[j + 1]) {
        ;[arr[j], arr[j + 1]] = [arr[j + 1], arr[j]]
        // 如果出现有元素交换，则表明此躺可能没有完成排序
        finish = false
      }
      console.log(`    第${j + 1}次`, arr)
    }
    // 如果当前趟都没有进行元素的交换，证明前面一趟比较已经排好序
    // 直接退出循环
    if (finish) break
  }
  // console.timeEnd('sort2')
  return arr
}
```

测试：

```text
第1趟
    第1次 [6, 9, 8, 3, 2, 11, 15, 16, 18, 19]
    第2次 [6, 8, 9, 3, 2, 11, 15, 16, 18, 19]
    第3次 [6, 8, 3, 9, 2, 11, 15, 16, 18, 19]
    第4次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第5次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第6次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第7次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第8次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第9次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
第2趟
    第1次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第2次 [6, 3, 8, 2, 9, 11, 15, 16, 18, 19]
    第3次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
    第4次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
    第5次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
    第6次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
    第7次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
    第8次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
第3趟
    第1次 [3, 6, 2, 8, 9, 11, 15, 16, 18, 19]
    第2次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
    第3次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
    第4次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
    第5次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
    第6次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
    第7次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
第4趟
    第1次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第2次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第3次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第4次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第5次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第6次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
第5趟
    第1次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第2次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第3次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第4次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
    第5次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
```

## 优化 2

从第一次优化后的结果可以看出，在每趟排序中，右面的许多元素已经是有序的结果了，可算法还是进行后面数值的排序，因此进行第二次优化。
因此如果序列尾部已经局部有序，可以记录最后 1 次交换的位置。每次比较比到这里为止，不需要进行后面的排序了，减少比较次数

```js
function bubbleSort3(arr) {
  // console.time('sort3')
  let i = arr.length - 1
  let n = 0
  while (i > 0) {
    console.log(`第${++n}趟`)
    let pos = 0
    // 每次都比较到上一次交换位置地方停止
    for (let j = 0; j < i; j++) {
      if (arr[j] > arr[j + 1]) {
        // 记录交换的位置
        pos = j
        ;[arr[j], arr[j + 1]] = [arr[j + 1], arr[j]]
      }
      console.log(`    第${j + 1}次`, arr)
    }
    i = pos
  }
  // console.timeEnd('sort3')
  return arr
}
```

测试

```js
const arr = [6, 9, 8, 3, 2, 11, 15, 16, 18, 19]
bubbleSort3(arr)
```

```text
第1趟
    第1次 [6, 9, 8, 3, 2, 11, 15, 16, 18, 19]
    第2次 [6, 8, 9, 3, 2, 11, 15, 16, 18, 19]
    第3次 [6, 8, 3, 9, 2, 11, 15, 16, 18, 19]
    第4次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第5次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第6次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第7次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第8次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第9次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
第2趟
    第1次 [6, 8, 3, 2, 9, 11, 15, 16, 18, 19]
    第2次 [6, 3, 8, 2, 9, 11, 15, 16, 18, 19]
    第3次 [6, 3, 2, 8, 9, 11, 15, 16, 18, 19]
第3趟
    第1次 [3, 6, 2, 8, 9, 11, 15, 16, 18, 19]
    第2次 [3, 2, 6, 8, 9, 11, 15, 16, 18, 19]
第4趟
    第1次 [2, 3, 6, 8, 9, 11, 15, 16, 18, 19]
```
